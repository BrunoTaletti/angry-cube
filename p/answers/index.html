<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Respostas de Briefing - Angry Cube</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="icon" href="./../../img/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="./../../img/icon.svg">
    <link rel="shortcut icon" href="./../../img/icon.svg" type="image/x-icon">

    <!-- ðŸ”¹ Font Awesome para Ã­cone de link externo -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap");

      body {
        font-family: "Montserrat", sans-serif;
        background-color: #f8f9fa;
        min-height: 100vh;
      }

      .textured-bg {
        background-image: url("./../../img/background.jpg");
        background-blend-mode: overlay;
        background-size: cover;
        background-position: center;
        min-height: 100vh;
      }

      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }

      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      /* --- CORES HEX --- */
      .color-chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-right: 10px;
        cursor: pointer;
        user-select: none;
        position: relative;
        transition: transform 0.1s ease;
      }

      .color-chip:hover {
        transform: scale(1.05);
      }

      .color-box {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        border: 1px solid #ccc;
      }

      .color-text {
        transition: color 0.2s ease;
      }

      .color-chip:hover .color-text {
        color: #1e40af;
      }

      /* Tooltip "Copiado!" */
      .copied-tooltip {
        position: absolute;
        top: -28px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #1e40af;
        color: white;
        font-size: 0.7rem;
        padding: 3px 6px;
        border-radius: 4px;
        opacity: 0;
        pointer-events: none;
        animation: fadeInOut 1.2s ease forwards;
      }

      @keyframes fadeInOut {
        0% {
          opacity: 0;
          transform: translate(-50%, -5px);
        }
        20% {
          opacity: 1;
          transform: translate(-50%, 0);
        }
        80% {
          opacity: 1;
          transform: translate(-50%, 0);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -5px);
        }
      }

      /* --- LINKS --- */
      .linkified {
        color: #1e40af;
        text-decoration: none;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        transition: transform 0.1s ease, color 0.2s ease;
      }

      .linkified:hover {
        transform: scale(1.05);
        color: #1e40af;
      }

      .linkified i {
        font-size: 0.75rem;
        margin-left: 2px;
        vertical-align: middle;
        position: relative;
        top: 0.5px;
      }
    </style>
  </head>

  <body class="min-h-screen bg-gray-50">
    <div
      class="textured-bg bg-blue-900 bg-opacity-90 flex flex-col min-h-screen py-12 px-4 sm:px-6 lg:px-8"
    >
      <div class="max-w-6xl mx-auto w-full flex-grow">
        <div class="text-center mb-12">
          <div class="flex justify-center mb-6">
            <div class="p-4 flex items-center justify-center">
              <img
                src="./../../img/angry-cube-logo.svg"
                alt="Logo"
                class="w-80"
              />
            </div>
          </div>
          <h1 class="text-3xl font-semibold text-white mb-2">
            Respostas de Briefing
          </h1>
          <p class="text-blue-100">Visualizar briefings enviados</p>
        </div>

        <!-- TABELA -->
        <div
          id="loading"
          class="text-center text-white text-lg py-8 animate-pulse"
        >
          Carregando respostas...
        </div>

        <div
          id="tableContainer"
          class="hidden bg-white rounded-xl shadow-2xl overflow-hidden"
        >
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-blue-900 text-white">
              <tr>
                <th
                  class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider"
                >
                  ID
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider"
                >
                  PÃ¡ginas
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider"
                >
                  Data
                </th>
                <th class="px-6 py-3 text-center text-xs font-medium uppercase">
                  AÃ§Ãµes
                </th>
              </tr>
            </thead>
            <tbody
              id="tableBody"
              class="divide-y divide-gray-100 bg-white"
            ></tbody>
          </table>
        </div>

        <div class="text-center mt-8 text-blue-100">
          <p>Â© 2025 Angry Cube. Todos os direitos reservados.</p>
        </div>
      </div>
    </div>

    <!-- ðŸ”¹ MODAL -->
    <div
      id="modal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-2"
    >
      <div
        class="bg-white rounded-2xl p-8 max-w-3xl w-full max-h-[80vh] overflow-y-auto scrollbar-hide shadow-xl relative"
      >
        <button
          id="closeModal"
          class="absolute top-4 right-4 text-gray-500 hover:text-gray-800"
        >
          <i data-feather="x" class="w-6 h-6"></i>
        </button>
        <div id="modalHeader" class="mb-4"></div>
        <div id="modalContent" class="space-y-4 text-gray-700"></div>
      </div>
    </div>

    <script>
      feather.replace();

      const API_URL =
        "https://script.google.com/macros/s/AKfycbzqLSNE_4usf9kzRrxeq-y_REg-QidKnm_9zZ_hUA7v25LWnnpp6mE5suq25cKzQump4g/exec";

      const loading = document.getElementById("loading");
      const tableContainer = document.getElementById("tableContainer");
      const tableBody = document.getElementById("tableBody");
      const modal = document.getElementById("modal");
      const modalHeader = document.getElementById("modalHeader");
      const modalContent = document.getElementById("modalContent");
      const closeModal = document.getElementById("closeModal");

      function formatDate(ts) {
        if (!ts) return "";
        try {
          let date;
          if (ts.includes("T")) date = new Date(ts);
          else if (ts.includes("/")) {
            const [d, m, rest] = ts.split("/");
            const [year, time] = rest.split(" ");
            date = new Date(`${year}-${m}-${d} ${time || "00:00"}`);
          } else return ts;

          const pad = (n) => n.toString().padStart(2, "0");
          return `${pad(date.getDate())}/${pad(
            date.getMonth() + 1
          )}/${date.getFullYear()} ${pad(date.getHours())}:${pad(
            date.getMinutes()
          )}`;
        } catch {
          return ts;
        }
      }

      function formatValue(value) {
        if (!value) return "";

        const colorRegex = /#(?:[0-9a-fA-F]{3}){1,2}\b/g;
        const urlRegex =
          /\b((https?:\/\/)?(www\.)?[\w-]+\.(com|net|org|site|online|br|info|io|pro|app|co)(\/\S*)?)/gi;

        return value
          .split(/(\s+)/)
          .map((word) => {
            if (colorRegex.test(word)) {
              return `<span class="color-chip" onclick="copyColor(this, '${word}')">
                        <span class="color-box" style="background:${word}"></span>
                        <span class="color-text">${word}</span>
                      </span>`;
            } else if (urlRegex.test(word)) {
              let href = word;
              if (!/^https?:\/\//i.test(href)) {
                href = "https://" + word;
              }
              return `<a href="${href}" target="_blank" class="linkified">${word}<i class="fas fa-external-link-alt"></i></a>`;
            }
            return word;
          })
          .join("");
      }

      function copyColor(element, color) {
        if (!element) return;

        navigator.clipboard.writeText(color).then(() => {
          const existing = element.querySelector(".copied-tooltip");
          if (existing) existing.remove();

          const tooltip = document.createElement("div");
          tooltip.className = "copied-tooltip";
          tooltip.textContent = "Copiado!";
          element.appendChild(tooltip);

          setTimeout(() => {
            tooltip.remove();
          }, 1200);
        });
      }

      async function fetchResponses() {
        try {
          const res = await fetch(API_URL);
          const data = await res.json();
          renderTable(data);
        } catch (err) {
          loading.textContent = "Erro ao carregar dados.";
          console.error(err);
        }
      }

      function renderTable(data) {
        if (!data.length) {
          loading.textContent = "Nenhum briefing encontrado.";
          return;
        }

        loading.classList.add("hidden");
        tableContainer.classList.remove("hidden");

        data.forEach((row) => {
          const idValue = row.id || row.ID || row.Id || row.iD || "-";
          const dateValue = formatDate(row.timestamp);

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="px-6 py-4 text-sm text-gray-700">${idValue}</td>
            <td class="px-6 py-4 text-sm text-gray-700">${row.pages || "-"}</td>
            <td class="px-6 py-4 text-sm text-gray-700">${dateValue || "-"}</td>
            <td class="px-6 py-4 text-center">
              <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1 rounded-lg text-sm transition view-btn" data-id="${idValue}">
                <i data-feather="eye" class="w-4 h-4 inline-block mr-1"></i> Ver
              </button>
            </td>
          `;
          tableBody.appendChild(tr);
        });

        feather.replace();

        document.querySelectorAll(".view-btn").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const id = e.currentTarget.getAttribute("data-id");
            const item = data.find(
              (r) =>
                String(r.id) === String(id) ||
                String(r.ID) === String(id) ||
                String(r.Id) === String(id)
            );
            openModal(item);
          });
        });
      }

      function openModal(item) {
        modalContent.innerHTML = "";
        modalHeader.innerHTML = "";

        const idValue = item.id || item.ID || item.Id || item.iD || "-";
        const dateValue = formatDate(item.timestamp);

        modalHeader.innerHTML = `
    <h2 class="text-2xl font-semibold text-blue-800 mb-1">Briefing #${idValue}</h2>
    <p class="text-sm text-gray-500">Enviado em: ${dateValue || "-"}</p>
    <div class="border-b border-gray-300 mt-2 mb-4"></div>
  `;

        const perguntasMap = {
          // 1. PÃ¡ginas contratadas
          pages: "1. Quais sÃ£o as duas pÃ¡ginas contratadas?",
          other_pages: "1. Outra (especifique):",

          // 2. PÃ¡gina 1
          page1_objective: "2a. Qual o objetivo principal da PÃ¡gina 1?",
          page1_sections: "2b. Quais sessÃµes essa pÃ¡gina precisa ter?",
          page1_musthave:
            "2c. HÃ¡ alguma seÃ§Ã£o ou conteÃºdo que vocÃª faz questÃ£o de ter?",
          page1_exclude:
            "2d. Deseja que algo nÃ£o esteja presente nessa pÃ¡gina?",

          // 3. PÃ¡gina 2
          page2_objective: "3a. Qual o objetivo principal da PÃ¡gina 2?",
          page2_sections: "3b. Quais sessÃµes essa pÃ¡gina precisa ter?",
          page2_musthave:
            "3c. HÃ¡ alguma seÃ§Ã£o ou conteÃºdo que vocÃª faz questÃ£o de ter?",
          page2_exclude:
            "3d. Deseja que algo nÃ£o esteja presente nessa pÃ¡gina?",

          // 4. Design e Identidade Visual
          brand_manual: "4a. Possui manual de marca?",
          typography:
            "4b. Qual Ã© a tipografia (fonte) da marca? Se nÃ£o tiver, hÃ¡ alguma preferÃªncia?",
          colors: "4c. Quais sÃ£o as cores principais que devemos usar?",
          avoid_colors:
            "4d. HÃ¡ cores, elementos ou estilos que nÃ£o podem ser usados?",
          visual_style: "4e. HÃ¡ algum estilo visual que vocÃª espera?",

          // 5. ConteÃºdo e Materiais
          materials:
            "5a. VocÃª jÃ¡ possui algum material que deve ser usado no site?",
          other_materials: "5a. Outros materiais (especifique)",
          material_instructions:
            "5a. Envie os arquivos ou o link para download:",
          text_inclusions:
            "5b. HÃ¡ algo que vocÃª gostaria de garantir que esteja incluÃ­do nos textos?",

          // 6. Produto / ServiÃ§o
          product_service:
            "6a. Qual Ã© o produto ou serviÃ§o sendo apresentado neste projeto?",

          // 7. InspiraÃ§Ãµes e ReferÃªncias
          reference1: "7a. Site de referÃªncia 1",
          reference2: "7a. Site de referÃªncia 2",
          reference3: "7a. Site de referÃªncia 3",
          reference4: "7a. Site de referÃªncia 4 (opcional)",
          reference5: "7a. Site de referÃªncia 5 (opcional)",
          reference_details:
            "7b. Algum detalhe especÃ­fico dessas referÃªncias que vocÃª gostaria de reproduzir?",
          reference_avoid:
            "7c. Tem algo que vocÃª viu em outros sites que NÃƒO quer no seu?",

          // 8. Tecnologia
          tech_preference:
            "8a. VocÃª possui alguma preferÃªncia em relaÃ§Ã£o Ã  tecnologia usada no site?",
          tech_limitations:
            "8b. Existe alguma limitaÃ§Ã£o tÃ©cnica ou exigÃªncia especÃ­fica?",

          // 9. Posicionamento e PercepÃ§Ã£o
          brand_vision:
            "9a. Qual Ã© a visÃ£o que vocÃª quer transmitir com esse site?",
          user_feeling:
            "9b. Como vocÃª quer que as pessoas se sintam ao navegar pelo seu site?",
          target_audience: "9c. Quem Ã© o pÃºblico-alvo deste site?",
          brand_perception:
            "9d. Como vocÃª gostaria de ser visto por esse pÃºblico?",

          // 10. DomÃ­nio e Hospedagem
          has_domain: "10a. VocÃª jÃ¡ possui um domÃ­nio registrado?",
          domain: "10a. Qual Ã© o domÃ­nio?",
          help_register: "10a. Precisa de ajuda para registrar?",
          has_hosting: "10b. JÃ¡ possui hospedagem contratada?",
          hosting_provider: "10b. Qual provedor?",
          hosting_access: "10b. Acesso serÃ¡ fornecido?",
          hosting_help: "10b. Precisa de indicaÃ§Ã£o ou contrataÃ§Ã£o?",
          cms_preference:
            "10c. Tem preferÃªncia de tecnologia, plataforma ou CMS?",

          // ConfirmaÃ§Ã£o
          agree_terms: "Concordo com os termos e condiÃ§Ãµes",
        };

        const keys = Object.keys(item).filter(
          (k) =>
            !["id", "ID", "Id", "iD", "timestamp"].includes(k) &&
            item[k] &&
            item[k].trim() !== ""
        );

        if (!keys.length) {
          modalContent.innerHTML =
            "<p class='text-gray-500 italic'>Nenhuma resposta disponÃ­vel.</p>";
        } else {
          keys.forEach((key) => {
            const pergunta =
              perguntasMap[key] || key.replaceAll("_", " ").toUpperCase();
            const value = formatValue(item[key]);

            modalContent.innerHTML += `
        <div class="border-b border-gray-200 pb-2">
          <h3 class="text-sm font-semibold text-blue-800">${pergunta}</h3>
          <p class="text-gray-700 whitespace-pre-wrap">${value}</p>
        </div>
      `;
          });
        }

        modal.classList.remove("hidden");
        feather.replace();
      }

      closeModal.addEventListener("click", () => modal.classList.add("hidden"));
      modal.addEventListener("click", (e) => {
        if (e.target === modal) modal.classList.add("hidden");
      });

      fetchResponses();
    </script>
  </body>
</html>
